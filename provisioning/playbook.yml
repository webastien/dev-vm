- hosts: all
  # Get the default config
  vars_files:
    - vars/default-config.yml
  pre_tasks:
    # Verify Ansible can run this playbook
    - name: Check ansible version
      assert:
        that: ansible_version.full | version_compare('2.2', '>=')
        msg:  You need to update Ansible!
    # Merge user defined config if exists
    - name: Include user defined configuration
      include_vars:  "{{ item }}"
      with_fileglob: [ vars/config.yml ]
  # Include tasks to play when provisioning
  tasks:
    - name:    Include our tasks to the playbook
      include: tasks/{{ task }}/main.yml
      # Settings a different item name here because {{ item }} can be used in included files
      loop_control:
        loop_var: task
      # Beware: the order of this list is important...
      # For example, sites will depend on php, mysql, apache, ...
      with_items: [ utils, mysql, php, apache, sites ]

